class ProductLightbox{constructor(t={}){this.options={mainImageSelector:"#prod-img-main",thumbnailSelectors:["#prod-img-1","#prod-img-2","#prod-img-3"],galleryContainerSelector:".product-header4_image-grid",...t},this.images=[],this.fancyboxInstance=null,this.initFancybox=this.initFancybox.bind(this),this.updateImages=this.updateImages.bind(this),this.createGallery=this.createGallery.bind(this),this.openGallery=this.openGallery.bind(this),this.initFancybox()}initFancybox(){if("undefined"==typeof Fancybox)return void setTimeout(this.initFancybox,100);Fancybox.defaults={...Fancybox.defaults,Images:{zoom:!0},Thumbs:{autoStart:!0},Carousel:{transition:"slide"}},this.removeWebflowLightbox();const t=document.querySelector(this.options.mainImageSelector);t&&t.addEventListener("click",(t=>{t.preventDefault(),this.openGallery(0)})),this.createMobileSlideshow()}removeWebflowLightbox(){document.querySelectorAll(".w-lightbox").forEach((t=>{t.classList.remove("w-lightbox"),t.addEventListener("click",(e=>{t.closest("a")&&e.preventDefault()}));const e=t.querySelector(".w-json");e&&e.remove()}))}updateImages(t){return this.images=t.map((t=>({src:t.node.url,thumb:t.node.url,alt:t.node.altText||"Product image"}))),this.images}createGallery(){if(!this.images||0===this.images.length)return;const t=document.querySelector(this.options.mainImageSelector);if(t){const e=t.closest("a")||t.parentNode;e.setAttribute("data-fancybox","product-gallery"),e.setAttribute("data-src",this.images[0].src),e.style.cursor="pointer","A"===e.tagName&&e.removeAttribute("href")}this.options.thumbnailSelectors.forEach(((t,e)=>{const i=e+1;if(i>=this.images.length)return;const o=document.querySelector(t);if(o){const t=o.closest("a")||o.parentNode;t.setAttribute("data-fancybox","product-gallery"),t.setAttribute("data-src",this.images[i].src),t.style.cursor="pointer","A"===t.tagName&&t.removeAttribute("href"),t.addEventListener("click",(t=>{t.preventDefault(),this.openGallery(i)}))}}))}openGallery(t=0){this.images&&0!==this.images.length&&Fancybox.show(this.images,{startIndex:t})}createMobileSlideshow(){if(window.innerWidth>767)return;const t=document.querySelector(this.options.galleryContainerSelector);if(!t||!this.images.length)return;const e=document.createElement("div");e.className="mobile-product-slideshow",this.images.forEach((t=>{const i=document.createElement("div");i.className="mobile-slide";const o=document.createElement("img");o.src=t.src,o.alt=t.alt,o.addEventListener("click",(()=>Fancybox.show(this.images))),i.appendChild(o),e.appendChild(i)})),t.parentNode.insertBefore(e,t)}}class ProductPage{constructor(t,e){this.client=t,this.cart=e,this.product=null,this.selectedVariant=null}async loadProduct(){const t=$("#product-embed");if(!t)return null;const e=t.dataset.shopifyId;return e?(this.product=await this.client.getProductById(e),this.product):null}renderProduct(){if(!this.product)return;safeDom("#prod-title",(t=>{t.textContent=this.product.title,t.classList.remove("invisible-before-load")})),safeDom("#prod-desc",(t=>{t.innerHTML=this.product.descriptionHtml,t.classList.remove("invisible-before-load")}));const t=this.product.images.edges;window.productLightbox&&t.length>0?(window.productLightbox.updateImages(t),safeDom("#prod-img-main",(e=>{t[0]?.node.url?(e.src=t[0].node.url,e.alt=t[0].node.altText||this.product.title,e.closest(".product-header4_lightbox-link").style.display=""):e.closest(".product-header4_lightbox-link").style.display="none",e.classList.remove("invisible-before-load")})),["prod-img-1","prod-img-2","prod-img-3"].forEach(((e,i)=>{const o=i+1;safeDom(`#${e}`,(e=>{o<t.length&&t[o]?.node.url?(e.src=t[o].node.url,e.alt=t[o].node.altText||this.product.title,e.closest(".product-header4_lightbox-link").style.display=""):e.closest(".product-header4_lightbox-link").style.display="none",e.classList.remove("invisible-before-load")}))})),window.productLightbox.createGallery()):t.length>0?(safeDom("#prod-img-main",(e=>{t[0]?.node.url?(e.src=t[0].node.url,e.alt=t[0].node.altText||this.product.title,e.closest(".product-header4_lightbox-link").style.display=""):e.closest(".product-header4_lightbox-link").style.display="none",e.classList.remove("invisible-before-load")})),["prod-img-1","prod-img-2","prod-img-3"].forEach(((e,i)=>{const o=i+1;safeDom(`#${e}`,(e=>{o<t.length&&t[o]?.node.url?(e.src=t[o].node.url,e.alt=t[o].node.altText||this.product.title,e.closest(".product-header4_lightbox-link").style.display=""):e.closest(".product-header4_lightbox-link").style.display="none",e.classList.remove("invisible-before-load")}))}))):(safeDom("#prod-img-main",(t=>{t.closest(".product-header4_lightbox-link").style.display="none"})),["prod-img-1","prod-img-2","prod-img-3"].forEach((t=>{safeDom(`#${t}`,(t=>{t.closest(".product-header4_lightbox-link").style.display="none"}))}))),this.renderVariantSelect(),this.updateSelectedVariant(),safeDom("#prod-price",(t=>t.classList.remove("invisible-before-load")))}renderVariantSelect(){const t=this.product.variants.edges;0!==t.length&&safeDom("#size-select",(e=>{e.innerHTML="",t.forEach((({node:t})=>{const i=document.createElement("button");i.type="button",i.className="variant-button"+(t.availableForSale?"":" disabled"),i.textContent=t.title,i.dataset.variantId=t.id,i.disabled=!t.availableForSale,i.addEventListener("click",(()=>{e.querySelectorAll(".variant-button").forEach((t=>t.classList.remove("active"))),i.classList.add("active"),e.dataset.selectedVariant=t.id,this.updateSelectedVariant()})),e.appendChild(i)}));const i=e.querySelector(".variant-button:not(.disabled)");i&&(i.classList.add("active"),e.dataset.selectedVariant=i.dataset.variantId),this.updateSelectedVariant()}))}updateSelectedVariant(){const t=$("#size-select");if(!t)return;const e=t.dataset.selectedVariant;if(this.selectedVariant=this.product.variants.edges.find((({node:t})=>t.id===e))?.node,this.selectedVariant){safeDom("#prod-price",(t=>{const{amount:e,currencyCode:i}=this.selectedVariant.priceV2;t.textContent=new Intl.NumberFormat("en-US",{style:"currency",currency:i}).format(e)}));const t=this.selectedVariant.quantityAvailable;let e=document.getElementById("stock-warning");if(!e){const t=document.getElementById("prod-price");t&&t.parentNode&&(e=document.createElement("div"),e.id="stock-warning",e.style.color="#c00",e.style.marginTop="4px",t.parentNode.insertBefore(e,t.nextSibling))}e&&("number"==typeof t&&t>0&&t<10?(e.textContent=`Only ${t} left in stock!`,e.style.display="flex"):e.style.display="none")}}setupAddToCartButton(){safeDom("#add-to-cart",(t=>{t.dataset.originalText||(t.dataset.originalText="Add to Cart"),t.textContent=t.dataset.originalText,t.addEventListener("click",(async()=>{if(!this.selectedVariant)return;const e=$("#qty"),i=e?parseInt(e.value,10):1;i>0&&(t.disabled=!0,t.textContent="Adding...",await this.cart.addItem(this.selectedVariant.id,i),await this.cart.renderCart(),this.cart.toggleCart(),t.disabled=!1,t.textContent=t.dataset.originalText)}))}))}init(){this.loadProduct().then((t=>{t&&(this.renderProduct(),this.setupAddToCartButton())}))}}document.addEventListener("DOMContentLoaded",(()=>{if($("#product-embed")&&(window.productLightbox=new ProductLightbox,window.shopifyClient&&window.shopifyCart)){new ProductPage(window.shopifyClient,window.shopifyCart).init()}}));